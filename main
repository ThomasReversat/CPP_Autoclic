#include <iostream>
#include <chrono>
#include <windows.h> // SDK windows
#include <windowsx.h>
#include <string>
#include "Cycle.hpp"
#include "Tache.hpp"
#define NOMBRE 10
//#define TIME 5.

using namespace std;
#define _WIN32_WINNT 0x0500
// definition des fonctions clics ici
void clic_ici(int x,int y)
{
    INPUT i[2];
    memset(i, 0, sizeof(i));
    i[0].type = i[1].type = INPUT_MOUSE;
    i[0].mi.dx = (65535. / (double)GetSystemMetrics(SM_CXSCREEN)) * x;
    i[0].mi.dy = (65535. / (double)GetSystemMetrics(SM_CYSCREEN)) * y;
    i[0].mi.dwFlags = MOUSEEVENTF_MOVE|MOUSEEVENTF_ABSOLUTE|MOUSEEVENTF_LEFTDOWN;
    i[1].mi.dwFlags = MOUSEEVENTF_LEFTUP;
    SendInput(2, i, sizeof(INPUT));
}

void enchainer_clic(int x,int y,int nb)
{
    for(int i=0;i<nb;i++) // suite de clics (de repetitions)
    {
        clic_ici(x,y); // on enchaine nb clics
    }
}

void clic_tache_duree_simple(int x, int y, std::string tache)
{
    /* realise un clique à la position (x,y) pour une tache donnee */
    cout <<"Veuillez saisir une tache"<<endl;
    cin >>tache;
    clic_ici(x,y);
}
string renommerTache(string mot)
{
    /*renommer une tache t */
    string tache = mot;
    return tache;
}
void supprimerTache(string t)
{
    t.clear(); // supprime une tache t
}
string dupliquerTache(string t,int n)
{
    string tache = " ";
    for(int i=0;i<n;i++)/* n tours de boucles */
    {
        tache = tache +"\n"+t+"\n";
    }
    return tache;
}
string ajouterTache(string t)
{
    /* ajouter une tache t dans une autre tache  */
    string tache=" ";
    tache.append(t);
    return t;
}

void historiqueTaches(vector <string>tab,string tache,int i)
{
    /* affiche l'historique des taches dans un tableau de vector à la i eme position */
    tab[i]=tache;
}
void clic_duree(int x,int y,float t,int nb)
{
    /* effectue un clic au position x et y de duree t un nombre de fois nb */

    for(int i=0;i<nb;i++)
    {
        clic_ici(x,y);
        Sleep(t); // une pause en milliseconde
    }
}
int main() {
    string tache0;
    string tache1;
    string tache2;
    string tache3;
    string tache4;
    int var0;
    int var1;
    int var2;
    int var3;
    int x,y;
    int tache(0);
    string b1,b2;
    float time;
    auto t_start = std::chrono::high_resolution_clock::now();
    cout <<"Bonjour"<<endl;
    cout <<"Veuillez saisir un entier qui representera la liste des taches"<<endl;
    cout << " Cet entier doit etre compris entre 0 et 4"<<endl;
    cin >> tache;
    switch (tache) {
        case 0 :
            cout << "Click Interval" << endl; // tache 1
            cout << "=================================================="<<endl;
            cout << "Souhaitez vous renommer la tache ?" << endl;
            cout << "Souhaitez vous la supprimer ?" << endl;
            cout << "Souhaitez vous dupliquez la tache" << endl;
            cout << "Souhaitez vous ajoutez la tache" << endl;
            cout << "=================================================="<<endl;
            cout << "Veuillez saisir un entier mais compris entre 0 et 3" << endl;
            cin >> var0;
            switch (var0) {
                case 0 :
                    cout << "Veuillez saisir le nom d'une tache " << endl;
                    cin >> tache0;
                    renommerTache(tache0);
                    cout << renommerTache("Click Interval") << endl;
                    cout << "=================================================="<<endl;
                    cout << "un interval de temps sera definie entre l'interval des deux clics automatiquement"<<endl;
                    cout << "Saisir les coordonnes du clics"<<endl;
                    cin>>x>>y;
                    clic_ici(x,y);
                    Sleep(9000);
                    cout << "Souhaitez vous enchainez les clics gauche et droit ?"<<endl;
                    cout << "Saisir True pour effectuez la tache ou False pour continuez"<<endl;
                    cin >> b1;
                    if (b1 == "True")
                    {
                        enchainer_clic(x,y,NOMBRE);
                    }
                    // else on continue

                    break;
                case 1 :
                    cout << "Saisir une tache que vous souhaitez supprimez" << endl;
                    cin >> tache0;
                    supprimerTache(tache0);
                    cout << "========================================================"<<endl;
                    cout << "un interval de temps est definit automatiquement"<<endl;
                    cout << "Saisir les coordonnes du clics"<<endl;
                    cin >>x>>y;
                    cout <<"Souhaitez vous enchainez des clics ?"<<endl;
                    cout <<"Y/N"<<endl;
                    cin>>tache4;
                    cout <<"Veuillez choisir une duree"<<endl;
                    cin>>time;
                    clic_duree(x,y,time,NOMBRE);
                    Sleep(9000);
                    break;
                case 2 :
                    cout << "Saisir une tache que vous souhaitez dupliquez" << endl;
                    cin >> tache0;
                    dupliquerTache(tache0, 5);
                    cout << dupliquerTache(tache0, 5) << endl;
                    cout << "=================================================="<<endl;
                    cout << "un interval de temps est definit automatiquement"<<endl;
                    cout << "Saisir les coordonnes du clics"<<endl;
                    cin >>x>>y;
                    cout <<"Souhaitez vous enchainez des clics ?"<<endl;
                    cout <<"Y/N"<<endl;
                    cin>>tache4;
                    cout <<"Veuillez choisir une duree"<<endl;
                    cin>>time;
                    clic_duree(x,y,time,NOMBRE);
                    Sleep(9000);
                    break;
                case 3 :
                    cout << "saisir une tache que vous souhaitez ajoutez dans la liste" << endl;
                    cin >> tache0;
                    ajouterTache(tache0);
                    cout <<"==================================================================";
                    cout << "un interval de temps est definit automatiquement"<<endl;
                    cout << "Saisir les coordonnes du clics"<<endl;
                    cin >>x>>y;
                    cout <<"Souhaitez vous enchainez des clics ?"<<endl;
                    cout <<"Y/N"<<endl;
                    cin>>tache4;
                    cout <<"Veuillez choisir une duree"<<endl;
                    cin>>time;
                    clic_duree(x,y,time,NOMBRE);
                    Sleep(9000);
                    break;
                default:
                    cout << "resaisir un entier entre 0 et 3" << endl;
            }
            break;

        case 1:
            cout << "Click Options" << endl; // tache 2
            cout << "Souhaitez vous renommer la tache ?" << endl;
            cout << "Souhaitez vous la supprimer ?" << endl;
            cout << "Souhaitez vous dupliquez la tache" << endl;
            cout << "Souhaitez vous ajoutez la tache" << endl;
            cout << "Veuillez saisir un entier mais compris entre 0 et 4" << endl;
            switch(var1)
            {
                case 0 : cout << "Veuillez saisir le nom d'une tache"<<endl;
                int n;
                cin >> tache1;
                renommerTache(tache1);
                cout << renommerTache(tache1);
                cout <<"==========================================================="<<endl;
                cout <<"Choisir votre type de click"<<endl;
                cout <<"1 - clic simple "<<endl;
                cout <<"2 - enchainer les clics"<<endl;
                cout << "3 - clic duree"<<endl;
                cout <<"4- clic a tache duree simple"<<endl;
                cin >>n;
                if (n == 1)
                {
                    clic_ici(x,y);
                }
                else if (n == 2)
                {
                    enchainer_clic(x,y,NOMBRE);
                }
                else if(n==3)
                {
                    clic_tache_duree_simple(x,y,"CLIC OPTIONS");
                }
                else
                {
                    clic_duree(x,y,time,NOMBRE);
                }
                break;

                case 1 : cout << "Veuillez saisir une tache que vous souhaitez supprimez"<<endl;
                cin >>tache1;
                supprimerTache(tache1);
                    cout <<"==========================================================="<<endl;
                    cout <<"Choisir votre type de click"<<endl;
                    cout <<"1 - clic simple "<<endl;
                    cout <<"2 - enchainer les clics"<<endl;
                    cout << "3 - clic duree"<<endl;
                    cout <<"4- clic a tache duree simple"<<endl;
                    cin >>n;
                    if (n == 1)
                    {
                        clic_ici(x,y);
                    }
                    else if (n == 2)
                    {
                        enchainer_clic(x,y,NOMBRE);
                    }
                    else if(n==3)
                    {
                        clic_tache_duree_simple(x,y,"CLIC OPTIONS");
                    }
                    else
                    {
                        clic_duree(x,y,time,NOMBRE);
                    }
                break;

                case 2 : cout << "Veuillez saisir une tache que vous souhaitez dupliquez"<<endl;
                cin >>tache1;
                    dupliquerTache(tache1,5);
                    cout <<"==========================================================="<<endl;
                    cout <<"Choisir votre type de click"<<endl;
                    cout <<"1 - clic simple "<<endl;
                    cout <<"2 - enchainer les clics"<<endl;
                    cout << "3 - clic duree"<<endl;
                    cout <<"4- clic a tache duree simple"<<endl;
                    cin >>n;
                    if (n == 1)
                    {
                        clic_ici(x,y);
                    }
                    else if (n == 2)
                    {
                        enchainer_clic(x,y,NOMBRE);
                    }
                    else if(n==3)
                    {
                        clic_tache_duree_simple(x,y,"CLIC OPTIONS");
                    }
                    else
                    {
                        clic_duree(x,y,time,NOMBRE);
                    }
                    break;

                case 3 : cout <<"veuillez saisir une tache que vous souhaitez ajoutez dans la liste"<<endl;
                cin >>tache1;
                    ajouterTache(tache1);
                    cout <<"==========================================================="<<endl;
                    cout <<"Choisir votre type de click"<<endl;
                    cout <<"1 - clic simple "<<endl;
                    cout <<"2 - enchainer les clics"<<endl;
                    cout << "3 - clic duree"<<endl;
                    cout <<"4- clic a tache duree simple"<<endl;
                    cin >>n;
                    if (n == 1)
                    {
                        clic_ici(x,y);
                    }
                    else if (n == 2)
                    {
                        enchainer_clic(x,y,NOMBRE);
                    }
                    else if(n==3)
                    {
                        clic_tache_duree_simple(x,y,"CLIC OPTIONS");
                    }
                    else
                    {
                        clic_duree(x,y,time,NOMBRE);
                    }
                    break;

                default : cout <<"resaisir un entier compris entre 1 et 3"<<endl;

            }

            break;
        case 2 :
            cout << "Click Repeat" << endl; // tache 3
            cout <<"*========================================================*"<<endl;
            cout << "Souhaitez vous renommer la tache ?" << endl;
            cout << "Souhaitez vous la supprimer ?" << endl;
            cout << "Souhaitez vous dupliquez la tache" << endl;
            cout << "Souhaitez vous ajoutez la tache" << endl;
            cout << "Veuillez saisir un entier mais compris entre 0 et 3" << endl;
            switch(var2)
            {
                case 0 : cout << "Veuillez saisir le nom d'une tache"<<endl;
                cin >>tache2;
                    renommerTache(tache2);
                    cout <<renommerTache(tache2);
                    cout <<"*========================================================*"<<endl;
                    enchainer_clic(x,y,NOMBRE);
                    Sleep(9000);
                    break;

                case 1: cout << "Veuillez saisir une tache que vous souhaitez supprimez"<<endl;
                cin >> tache2;
                    supprimerTache(tache2);
                    cout <<"*========================================================*"<<endl;
                    enchainer_clic(x,y,NOMBRE);
                    Sleep(9000);
                    break;
                case 2: cout << "Veuillez saisir une tache que vous souhaitez dupliquez "<<endl;
                cin >>tache2;
                    dupliquerTache(tache2,10);
                    cout <<"*========================================================*"<<endl;
                    enchainer_clic(x,y,NOMBRE);
                    Sleep(9000);
                    break;
                case 3: cout << "Veuillez saisir une tache que vous souhaitez ajoutez dans la liste"<<endl;
                cin >>tache2;
                    ajouterTache(tache2);
                    cout <<"*========================================================*"<<endl;
                    enchainer_clic(x,y,NOMBRE);
                    Sleep(9000);
                    break;
                default: cout <<"resaisir un entier compris entre 1 et 3"<<endl;
            }
            break;
        case 3 :
            cout << "Cursor Position" << endl; // tache 4
            cout <<"*========================================================*"<<endl;
            cout << "Souhaitez vous renommer la tache ?" << endl;
            cout << "Souhaitez vous la supprimer ?" << endl;
            cout << "Souhaitez vous dupliquez la tache" << endl;
            cout << "Souhaitez vous ajoutez la tache" << endl;
            cout <<"*========================================================*"<<endl;
            cout << "Veuillez saisir un entier mais compris entre 1 et 3" << endl;
            switch(var3)
            {
                case 1: cout << "Veuillez saisir une tache que vous souhaitez supprimez"<<endl;
                    cin >> tache3;
                    supprimerTache(tache3);
                    cout <<"*========================================================*"<<endl;
                    SetCursorPos(x,y);
                    break;
                case 2: cout << "Veuillez saisir une tache que vous souhaitez dupliquez "<<endl;
                    cin >>tache3;
                    dupliquerTache(tache3,10);
                    cout <<"*========================================================*"<<endl;
                    SetCursorPos(x,y);
                    break;
                case 3:  cout << "Veuillez saisir une tache que vous souhaitez ajoutez dans la liste"<<endl;
                    cin >>tache3;
                    ajouterTache(tache3);
                    cout <<"*========================================================*"<<endl;
                    SetCursorPos(x,y);
                    break;
                default: cout <<"resaisir un entier compris entre 1 et 3"<<endl;
            }
            break;
        case 4 :
            cout << "Autre options" << endl; // tache 5
            break;
        default :
            cout << "resaisir un chiffre entre 1 et 4" << endl;

    }

    auto t_end = std::chrono::high_resolution_clock::now();
    double elapsed_time_ms = std::chrono::duration<double, std::milli>(t_end-t_start).count();


   // enchainer_clic(10,3,10);
    /* =================================================================================
     *
     *
     *
     */

   // SetCursorPos(0,0); // placer le curseur n'importe ou sur l'ecran
  //  Sleep(5000);
 //   clic_tache_duree_simple(10,10,"click options");
  //  auto t_start = std::chrono::high_resolution_clock::now(); //definis un intervalle de temps
    mouse_event(MOUSEEVENTF_LEFTDOWN, 10, 100, 0, 0); //simulation double clic gauche
  //  auto t_end = std::chrono::high_resolution_clock::now();
  //  double elapsed_time_ms = std::chrono::duration<double, std::milli>(t_end-t_start).count();
Sleep(9000);
    mouse_event(MOUSEEVENTF_LEFTUP, 0, 0, 0, 0); // double clic droit
    return 0;
}

